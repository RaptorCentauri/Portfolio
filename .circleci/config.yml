version: 2.1  # Use CircleCI 2.1

executors:
  python-3.9-executor:
    docker:
      - image: circleci/python:3.9  # Use an official Python image

commands:
  get_pip:
    description: "Install pip for Python 3.9"
    steps:
      - run: sudo apt-get update
      - run: sudo apt-get install python3-pip -y
      - run: pip3 install --upgrade pip

  get_aws_cli:
    description: "Install AWS CLI"
    steps:
      - run: sudo pip3 install awscli --upgrade

  install_npm:
    description: "Install the latest npm version"
    steps:
      - run: sudo npm install -g npm@latest

  install_dependencies:
    description: "Install project dependencies"
    steps:
      - run: npm install

  test_code:
    description: "Test the code"
    steps:
      - run: npm test

  test_coverage:
    description: "Check the code coverage"
    steps:
      - run: npm run coverage

  build_project:
    description: "Build the project"
    steps:
      - run: npm run build

  deploy_project:
    description: "Deploy the project"
    steps:
      - run: npm run deploy

jobs:
  build:
    executor: python-3.9-executor  # Use the Python executor
    steps:
      - checkout
      - get_pip
      - get_aws_cli
      - install_npm
      - install_dependencies
      - test_code
      - test_coverage
      - build_project
      - deploy_project
